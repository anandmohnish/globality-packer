[Unit]
Description=AWS ECS Agent
Requires=docker.service
After=docker.service

[Service]
TimeoutStartSec=0
Restart=always

ExecStartPre=-/usr/bin/docker stop %n
ExecStartPre=-/usr/bin/docker rm %n
ExecStartPre=/usr/bin/docker pull amazon/amazon-ecs-agent:latest
ExecStart=/usr/bin/docker run --name %n \
	--detach=true \
	--restart=on-failure:10 \
	--volume=/var/run/docker.sock:/var/run/docker.sock \
	--volume=/var/log/ecs:/log \
	--volume=/var/lib/ecs/data:/data \
	--net=host \
	--env-file=/etc/ecs/ecs.config \
	--env=ECS_LOGFILE=/log/ecs-agent.log \
	--env=ECS_DATADIR=/data/ \
	--env=ECS_ENABLE_TASK_IAM_ROLE=true \
	--env=ECS_ENABLE_TASK_IAM_ROLE_NETWORK_HOST=true \
	amazon/amazon-ecs-agent:latest

[Install]
WantedBy=multi-user.target
